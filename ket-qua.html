<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kết quả bài kiểm tra</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Kết quả bài làm</h1>
        
        <div id="result"></div>

        <div id="review-section">
            <h2>Xem lại bài làm và giải thích</h2>
            <div id="review-content"></div>
        </div>

        <a href="index.html" class="back-link">Quay về trang chủ</a>
    </div>

    <script>
        // --- PHẦN CÀI ĐẶT (Đã điền sẵn thông tin của bạn) ---
        const GOOGLE_FORM_ACTION_URL = 'https://docs.google.com/forms/d/e/1FAIpQLSfNn5BF8oejY9kTGkoTLIO0BzhF99R9fURFA6avaASmXPw32w/formResponse';
        const NAME_ENTRY_ID = '1858710141';
        const SCORE_ENTRY_ID = '1307362548';
        // --- KẾT THÚC PHẦN CÀI ĐẶT ---

        // Nơi chứa TẤT CẢ đáp án và giải thích cho MỌI bài thi
        const allQuizzesData = {
            'mau': {
                questions: {
                    q1: { text: '<strong>Câu 1:</strong> Thủ đô của Việt Nam là gì?', answer: 'c', explanation: 'Hà Nội là thủ đô của nước Cộng hòa Xã hội chủ nghĩa Việt Nam từ năm 1976.' },
                    q2: { text: '<strong>Câu 2:</strong> 5 x 8 bằng bao nhiêu?', answer: 'b', explanation: 'Phép nhân cơ bản: 5 nhân 8 bằng 40.' }
                },
                options: {
                    q1: { a: 'A. TP. Hồ Chí Minh', b: 'B. Đà Nẵng', c: 'C. Hà Nội' },
                    q2: { a: 'A. 35', b: 'B. 40', c: 'C. 45' }
                }
            }
        };

        // Lấy dữ liệu từ localStorage
        const savedData = JSON.parse(localStorage.getItem('submissionData'));

        // Hàm gửi dữ liệu đến Google Forms (đã tinh gọn)
        async function submitToGoogleForms(name, score) {
            const formData = new FormData();
            formData.append(NAME_ENTRY_ID, name);
            formData.append(SCORE_ENTRY_ID, score);

            try {
                await fetch(GOOGLE_FORM_ACTION_URL, {
                    method: 'POST',
                    body: formData,
                    mode: 'no-cors'
                });
            } catch (error) {
                console.error('Lỗi khi gửi đến Google Forms:', error);
            }
        }

        // Hàm chính để xử lý và hiển thị
        function processResults() {
            if (!savedData) {
                document.getElementById('result').innerHTML = '<h3>Không tìm thấy dữ liệu bài làm.</h3>';
                return;
            }

            const { quizId, name, answers: userAnswers } = savedData;
            const quizData = allQuizzesData[quizId];
            
            if (!quizData) {
                 document.getElementById('result').innerHTML = '<h3>Lỗi: Không tìm thấy dữ liệu cho bài kiểm tra này.</h3>';
                 return;
            }

            let score = 0;
            const totalQuestions = Object.keys(quizData.questions).length;
            let reviewHTML = '';

            for (const questionId in quizData.questions) {
                const questionInfo = quizData.questions[questionId];
                const userAnswerValue = userAnswers[questionId];
                
                reviewHTML += `<div class="review-item"><p>${questionInfo.text}</p>`;

                if (userAnswerValue) {
                    const userAnswerText = quizData.options[questionId][userAnswerValue];
                    reviewHTML += `<p><strong>Bạn chọn:</strong> ${userAnswerText}</p>`;
                    if (userAnswerValue === questionInfo.answer) {
                        score++;
                        reviewHTML += `<p class="review-correct">✅ Chính xác</p>`;
                    } else {
                        reviewHTML += `<p class="review-incorrect">❌ Sai rồi</p>`;
                        const correctAnswerKey = questionInfo.answer;
                        const correctAnswerText = quizData.options[questionId][correctAnswerKey];
                        reviewHTML += `<p class="review-correct-answer"><strong>Đáp án đúng:</strong> ${correctAnswerText}</p>`;
                    }
                } else {
                    reviewHTML += `<p><strong>Bạn chưa trả lời.</strong></p>`;
                }
                reviewHTML += `<div class="explanation"><strong>Giải thích:</strong> ${questionInfo.explanation}</div></div>`;
            }

            const scoreText = `${score}/${totalQuestions}`;
            document.getElementById('result').innerHTML = `<h3>Kết quả của ${name}: ${scoreText} câu đúng!</h3>`;
            document.getElementById('review-content').innerHTML = reviewHTML;
            
            // Gửi dữ liệu đi
            submitToGoogleForms(name, scoreText);

            // Xóa dữ liệu tạm
            localStorage.removeItem('submissionData');
        }

        processResults();
    </script>
</body>
</html>
